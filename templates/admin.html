{% extends "base.html" %}

{% block title %}Admin Panel{% endblock %}

{% block content %}
<div class="container-fluid mt-0 pt-0" style="min-height: 100vh; padding: 0;">
    <div class="card bg-dark bg-opacity-25 backdrop-blur-md border-0 shadow-lg" style="backdrop-filter: blur(10px); border-radius: 0; border: 1px solid rgba(68, 209, 194, 0.2); min-height: 100vh;">
        <div class="card-body p-4">
            <h1 class="card-title text-center mb-4 text-primary-teal fw-bold">
                <i class='bx bx-shield-quarter me-2'></i>Admin Panel
            </h1>

            <ul class="nav nav-pills mb-4 justify-content-center gap-2">
                <li class="nav-item">
                    <a class="nav-link active px-4 py-2" data-bs-toggle="tab" href="#users">
                        <i class='bx bx-user-circle me-1'></i> Manage Users
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link px-4 py-2" data-bs-toggle="tab" href="#documents">
                        <i class='bx bx-file me-1'></i> Manage Documents
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link px-4 py-2" data-bs-toggle="tab" href="#logs">
                        <i class='bx bx-history me-1'></i> Audit Logs
                    </a>
                </li>
            </ul>

            <div class="tab-content" style="min-height: calc(100vh - 200px);">
                <!-- User Management -->
                <div class="tab-pane fade show active" id="users">
                    <div class="card bg-dark bg-opacity-50 border-0 shadow mb-4" style="border-radius: 12px; border: 1px solid rgba(68, 209, 194, 0.1);">
                        <div class="card-header bg-transparent border-bottom border-teal py-3">
                            <h3 class="m-0 text-primary-teal">
                                <i class='bx bx-user-plus me-2'></i>Add New User
                            </h3>
                        </div>
                        <div class="card-body p-4">
                            <form action="{{ url_for('manage_users') }}" method="POST" class="needs-validation" novalidate>
                                <input type="hidden" name="csrf_token" value="{{ session.get('csrf_token', '') }}">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="text" name="username" class="form-control bg-dark bg-opacity-50 text-white border-0" id="username" placeholder="Username" required style="border-bottom: 2px solid #44d1c2; border-radius: 10px; padding: 12px; box-shadow: 0 4px 10px rgba(68, 209, 194, 0.1); transition: all 0.3s ease;">
                                            <label for="username" class="text-light">Username</label>
                                            <div class="invalid-feedback">Please provide a username.</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="email" name="email" class="form-control bg-dark bg-opacity-50 text-white border-0" id="email" placeholder="Email" required style="border-bottom: 2px solid #44d1c2; border-radius: 10px; padding: 12px; box-shadow: 0 4px 10px rgba(68, 209, 194, 0.1); transition: all 0.3s ease;">
                                            <label for="email" class="text-light">Email</label>
                                            <div class="invalid-feedback">Please provide a valid email.</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="text" name="name" class="form-control bg-dark bg-opacity-50 text-white border-0" id="name" placeholder="Name" required style="border-bottom: 2px solid #44d1c2; border-radius: 10px; padding: 12px; box-shadow: 0 4px 10px rgba(68, 209, 194, 0.1); transition: all 0.3s ease;">
                                            <label for="name" class="text-light">Name</label>
                                            <div class="invalid-feedback">Please provide a name.</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="password" name="password" class="form-control bg-dark bg-opacity-50 text-white border-0" id="password" placeholder="Password" required style="border-bottom: 2px solid #44d1c2; border-radius: 10px; padding: 12px; box-shadow: 0 4px 10px rgba(68, 209, 194, 0.1); transition: all 0.3s ease;">
                                            <label for="password" class="text-light">Password</label>
                                            <div class="invalid-feedback">Please provide a password.</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="role" class="form-label text-light mb-2">Role</label>
                                        <select name="role" class="form-select bg-dark bg-opacity-50 text-white" id="role" required style="border: 1px solid rgba(68, 209, 194, 0.3); border-radius: 10px; padding: 12px; box-shadow: 0 4px 10px rgba(68, 209, 194, 0.1); transition: all 0.3s ease; height: 50px;">
                                            <option value="" disabled selected>Select a role</option>
                                            <option value="User">User</option>
                                            <option value="Admin">Admin</option>
                                        </select>
                                        <div class="invalid-feedback">Please select a role.</div>
                                    </div>
                                    <div class="col-md-6 d-flex align-items-center">
                                        <button type="submit" name="action" value="add_user" class="btn btn-custom-add px-5 py-3 ms-auto" style="background: linear-gradient(135deg, #44d1c2, #5e93f0); border: none; border-radius: 10px; box-shadow: 0 6px 15px rgba(68, 209, 194, 0.3); color: white; font-weight: 600; transition: all 0.3s ease;">
                                            <i class='bx bx-user-plus me-2'></i> Add User
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Existing Users Table -->
                    <div class="card bg-dark bg-opacity-50 border-0 shadow" style="border-radius: 12px; border: 1px solid rgba(68, 209, 194, 0.1);">
                        <div class="card-header bg-transparent border-bottom border-teal py-3">
                            <h3 class="m-0 text-primary-teal">
                                <i class='bx bx-group me-2'></i>Existing Users
                            </h3>
                        </div>
                        <div class="card-body p-4">
                            <div class="table-responsive">
                                <table class="table table-dark table-hover table-borderless align-middle">
                                    <thead>
                                        <tr class="text-primary-teal" style="border-bottom: 1px solid rgba(68, 209, 194, 0.3);">
                                            <th class="py-3">ID</th>
                                            <th class="py-3">Username</th>
                                            <th class="py-3">Email</th>
                                            <th class="py-3">Name</th>
                                            <th class="py-3">Role</th>
                                            <th class="py-3 text-center">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for user in users %}
                                            <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                                                <td class="py-3">{{ user.id }}</td>
                                                <td class="py-3">{{ user.username }}</td>
                                                <td class="py-3">{{ user.email }}</td>
                                                <td class="py-3">{{ user.name }}</td>
                                                <td class="py-3">
                                                    <span class="badge {{ 'bg-danger' if user.role == 'Admin' else 'bg-info' }} rounded-pill">
                                                        {{ user.role }}
                                                    </span>
                                                </td>
                                                <td class="py-3">
                                                    <div class="d-flex flex-wrap justify-content-center align-items-center gap-2">
                                                        <form action="{{ url_for('manage_users') }}" method="POST" class="d-inline">
                                                            <input type="hidden" name="user_id" value="{{ user.id }}">
                                                            <input type="hidden" name="csrf_token" value="{{ session.get('csrf_token', '') }}">
                                                            <div class="input-group input-group-sm align-items-center" style="max-width: 170px;">
                                                                <select name="role" class="form-select bg-dark text-white" style="max-width: 90px; border: 1px solid rgba(68, 209, 194, 0.3); border-radius: 8px 0 0 8px;">
                                                                    <option value="User" {% if user.role == 'User' %}selected{% endif %}>User</option>
                                                                    <option value="Admin" {% if user.role == 'Admin' %}selected{% endif %}>Admin</option>
                                                                </select>
                                                                <button type="submit" name="action" value="change_role" class="btn btn-primary btn-sm" style="background: linear-gradient(135deg, var(--primary-teal), var(--secondary-blue)); border: none; border-radius: 0 8px 8px 0;">
                                                                    <i class='bx bx-edit-alt'></i>
                                                                </button>
                                                            </div>
                                                        </form>
                                                        <form action="{{ url_for('manage_users') }}" method="POST" class="d-inline">
                                                            <input type="hidden" name="user_id" value="{{ user.id }}">
                                                            <input type="hidden" name="csrf_token" value="{{ session.get('csrf_token', '') }}">
                                                            <button type="submit" name="action" value="delete" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this user?')" style="background: linear-gradient(135deg, #ff6b6b, #ff8c8c); border: none; border-radius: 8px;">
                                                                <i class='bx bx-trash-alt'></i>
                                                            </button>
                                                        </form>
                                                        <!-- Edit Button triggers modal -->
                                                        <button type="button" class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editUserModal{{ user.id }}" style="background: linear-gradient(135deg, #ffc107, #ffca2c); color: #222; border-radius: 8px; border: none; box-shadow: 0 2px 5px rgba(255, 193, 7, 0.2); min-width: 80px; display: flex; align-items: center; justify-content: center;">
                                                            <i class='bx bx-edit-alt'></i>
                                                            <span class="ms-1">Edit</span>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- Move all user modals here, outside the table for proper rendering -->
                    {% for user in users %}
                    <div class="modal fade" id="editUserModal{{ user.id }}" tabindex="-1" aria-labelledby="editUserModalLabel{{ user.id }}" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content modal-user-edit-custom">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editUserModalLabel{{ user.id }}">
                                        <i class='bx bx-edit-alt'></i> Edit User
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <form action="{{ url_for('manage_users') }}" method="POST">
                                    <input type="hidden" name="user_id" value="{{ user.id }}">
                                    <input type="hidden" name="csrf_token" value="{{ session.get('csrf_token', '') }}">
                                    <div class="modal-body">
                                        <div class="mb-3">
                                            <label for="username_{{ user.id }}" class="form-label">Username</label>
                                            <input type="text" name="username" id="username_{{ user.id }}" class="form-control" value="{{ user.username }}" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="email_{{ user.id }}" class="form-label">Email</label>
                                            <input type="email" name="email" id="email_{{ user.id }}" class="form-control" value="{{ user.email }}" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="name_{{ user.id }}" class="form-label">Name</label>
                                            <input type="text" name="name" id="name_{{ user.id }}" class="form-control" value="{{ user.name }}" required>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <button type="submit" name="action" value="edit_user" class="btn btn-primary">Save Changes</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <!-- Document Management -->
                <div class="tab-pane fade" id="documents">
                    <div class="card bg-dark bg-opacity-50 border-0 shadow mb-4" style="border-radius: 12px; border: 1px solid rgba(68, 209, 194, 0.1);">
                        <div class="card-header bg-transparent border-bottom border-teal py-3">
                            <h3 class="m-0 text-primary-teal">
                                <i class='bx bx-upload me-2'></i>Upload Document
                            </h3>
                        </div>
                        <div class="card-body p-4">
                            <form action="{{ url_for('upload') }}" method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
                                <input type="hidden" name="csrf_token" value="{{ session.get('csrf_token', '') }}">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="user_id" class="form-label text-light mb-2">Upload for User</label>
                                        <select name="user_id" class="form-select bg-dark bg-opacity-50 text-white" id="user_id" required style="border: 1px solid rgba(68, 209, 194, 0.3); border-radius: 10px; padding: 12px; box-shadow: 0 4px 10px rgba(68, 209, 194, 0.1); transition: all 0.3s ease; height: 50px;">
                                            <option value="" disabled selected>Select a user</option>
                                            {% for user in users %}
                                                <option value="{{ user.id }}">{{ user.username }}</option>
                                            {% endfor %}
                                        </select>
                                        <div class="invalid-feedback">Please select a user.</div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="input-group mb-3">
                                            <input type="file" name="document" class="form-control bg-dark bg-opacity-50 text-white" id="document" accept=".pdf,.docx,.txt" required style="border: 1px solid rgba(68, 209, 194, 0.3); border-radius: 10px 0 0 10px; padding: 12px; box-shadow: 0 4px 10px rgba(68, 209, 194, 0.1); transition: all 0.3s ease; height: 50px;">
                                            <button type="submit" class="btn btn-custom-upload px-4 py-2" style="background: linear-gradient(135deg, #44d1c2, #5e93f0); border: none; border-radius: 0 10px 10px 0; box-shadow: 0 6px 15px rgba(68, 209, 194, 0.3); color: white; font-weight: 600; transition: all 0.3s ease; height: 50px;">
                                                <i class='bx bx-upload me-2'></i> Upload
                                            </button>
                                            <div class="invalid-feedback">Please choose a file.</div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Existing Documents Table -->
                    <div class="card bg-dark bg-opacity-75 border-0 shadow" style="border-radius: 12px; border: 1px solid rgba(68, 209, 194, 0.1); min-height: calc(100vh - 300px);">
                        <div class="card-header bg-transparent border-bottom border-teal py-3">
                            <h3 class="m-0 text-primary-teal">
                                <i class='bx bx-folder-open me-2'></i>All Documents
                            </h3>
                        </div>
                        <div class="card-body p-4">
                            <div class="table-responsive" style="min-height: calc(100vh - 350px); overflow-y: auto; position: relative; z-index: 1;">
                                <table class="table table-dark table-hover align-middle" style="background-color: #1a2e3b; color: #d1e7e0; width: 100%;">
                                    <thead>
                                        <tr class="text-primary-teal" style="border-bottom: 2px solid rgba(68, 209, 194, 0.5);">
                                            <th class="py-3">ID</th>
                                            <th class="py-3">Filename</th>
                                            <th class="py-3">Owner</th>
                                            <th class="py-3">Uploaded At</th>
                                            <th class="py-3 text-center">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for file in files %}
                                            <tr style="border-bottom: 15px solid transparent; padding-bottom: 15px;">
                                                <td class="py-5 text-light">{{ file.id }}</td>
                                                <td class="py-5 text-light">
                                                    <i class='bx bx-file text-primary-teal fs-5 me-2'></i>{{ file.filename }}
                                                </td>
                                                <td class="py-5 text-light">{{ file.user.username }}</td>
                                                <td class="py-5 text-light">{{ file.uploaded_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                                                <td class="py-5 text-center">
                                                    <div class="d-flex flex-wrap justify-content-center align-items-center gap-2" style="min-height: 60px;">
                                                        <a href="{{ url_for('download_file', file_id=file.id) }}" class="btn btn-custom-download uniform-btn" style="background-color: #44d1c2; color: white; border-radius: 6px; transition: all 0.3s ease; z-index: 2;">
                                                            <i class='bx bx-download me-1'></i> Download
                                                        </a>
                                                        <a href="{{ url_for('verify_signature', file_id=file.id) }}" class="btn btn-custom-verify uniform-btn" style="background-color: #5e93f0; color: white; border-radius: 6px; transition: all 0.3s ease; z-index: 2;">
                                                            <i class='bx bx-check-shield me-1'></i> Verify
                                                        </a>
                                                        <!-- Edit Button as Modal Trigger -->
                                                        <button type="button" class="btn btn-warning btn-sm uniform-btn" data-bs-toggle="modal" data-bs-target="#editFileModal{{ file.id }}" style="background: linear-gradient(135deg, #ffc107, #ffca2c); color: #222; border-radius: 6px; border: none; box-shadow: 0 4px 10px rgba(255, 193, 7, 0.3); transition: all 0.3s ease; z-index: 2;">
                                                            <i class='bx bx-edit'></i> Edit
                                                        </button>
                                                        <form action="{{ url_for('delete_file', file_id=file.id) }}" method="POST" class="d-inline">
                                                            <input type="hidden" name="csrf_token" value="{{ session.get('csrf_token', '') }}">
                                                            <button type="submit" class="btn btn-custom-delete uniform-btn" onclick="return confirm('Are you sure you want to delete this file?')" style="background: linear-gradient(135deg, #dc3545, #e4606d); color: white; border-radius: 6px; transition: all 0.3s ease; z-index: 2;">
                                                                <i class='bx bx-trash-alt me-1'></i> Delete
                                                            </button>
                                                        </form>
                                                    </div>
                                                    <!-- Edit File Modal -->
                                                    <div class="modal fade" id="editFileModal{{ file.id }}" tabindex="-1" aria-labelledby="editFileModalLabel{{ file.id }}" aria-hidden="true">
                                                        <div class="modal-dialog modal-dialog-centered">
                                                            <div class="modal-content p-4" style="background: rgba(56, 100, 102, 0.97); border-radius: 16px; color: #fff;">
                                                                <form action="{{ url_for('edit_file', file_id=file.id) }}" method="POST">
                                                                    <input type="hidden" name="csrf_token" value="{{ session.get('csrf_token', '') }}">
                                                                    <div class="modal-header border-0 pb-0">
                                                                        <h5 class="modal-title" id="editFileModalLabel{{ file.id }}"><i class='bx bx-edit'></i> Edit File</h5>
                                                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                    </div>
                                                                    <div class="modal-body pt-0">
                                                                        <div class="mb-4">
                                                                            <label for="new_filename_{{ file.id }}" class="form-label">File Name (with extension)</label>
                                                                            <input type="text" class="form-control bg-dark text-white"
                                                                                id="new_filename_{{ file.id }}"
                                                                                name="new_filename"
                                                                                value="{{ file.filename }}"
                                                                                required>
                                                                            <div class="form-text mt-1" style="color: rgba(255,255,255,0.7);">
                                                                                Example: document.pdf, report.docx, notes.txt
                                                                            </div>
                                                                        </div>
                                                                        <div class="mb-3">
                                                                            <label for="new_description_{{ file.id }}" class="form-label">Description</label>
                                                                            <textarea class="form-control bg-dark text-white"
                                                                                id="new_description_{{ file.id }}"
                                                                                name="new_description"
                                                                                rows="2">{{ file.description or '' }}</textarea>
                                                                            <div class="form-text" style="color: rgba(255,255,255,0.7);">Optional: Add or update a description for this file.</div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="modal-footer border-0 pt-0">
                                                                        <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
                                                                        <button type="submit" class="btn btn-primary"><i class='bx bx-save'></i> Save Changes</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Audit Logs -->
                <div class="tab-pane fade" id="logs">
                    <div class="card bg-dark bg-opacity-50 border-0 shadow" style="border-radius: 12px; border: 1px solid rgba(68, 209, 194, 0.1);">
                        <div class="card-header bg-transparent border-bottom border-teal py-3">
                            <h3 class="m-0 text-primary-teal">
                                <i class='bx bx-history me-2'></i>System Audit Logs
                            </h3>
                        </div>
                        <div class="card-body p-4">
                            <div class="table-responsive">
                                <table class="table table-dark table-hover table-borderless align-middle">
                                    <thead>
                                        <tr class="text-primary-teal" style="border-bottom: 1px solid rgba(68, 209, 194, 0.3);">
                                            <th class="py-3">Timestamp</th>
                                            <th class="py-3">User</th>
                                            <th class="py-3">Action</th>
                                            <th class="py-3">Details</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for log in logs %}
                                            <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                                                <td class="py-3">{{ log.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                                                <td class="py-3">{{ log.user.username if log.user else 'N/A' }}</td>
                                                <td class="py-3">
                                                    <span class="badge 
                                                        {% if 'login' in log.action.lower() %}bg-success
                                                        {% elif 'delete' in log.action.lower() %}bg-danger
                                                        {% elif 'add' in log.action.lower() %}bg-primary
                                                        {% elif 'edit' in log.action.lower() or 'update' in log.action.lower() %}bg-warning
                                                        {% else %}bg-info{% endif %} 
                                                        rounded-pill">
                                                        {{ log.action }}
                                                    </span>
                                                </td>
                                                <td class="py-3">{{ log.details or 'N/A' }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Custom styles for admin panel */
    .text-primary-teal {
        color: #44d1c2 !important;
    }
    
    .border-teal {
        border-color: #44d1c2 !important;
    }
    
    .nav-pills .nav-link {
        color: #d1e7e0;
        background-color: rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        border-radius: 8px;
    }
    
    .nav-pills .nav-link.active {
        background: linear-gradient(135deg, #44d1c2, #5e93f0);
        box-shadow: 0 4px 10px rgba(68, 209, 194, 0.3);
    }
    
    .nav-pills .nav-link:hover:not(.active) {
        background-color: rgba(68, 209, 194, 0.2);
    }
    
    .btn-custom-add:hover {
        background: linear-gradient(135deg, #37a99a, #4b7ce3);
        box-shadow: 0 8px 20px rgba(68, 209, 194, 0.4);
        transform: translateY(-3px);
    }
    
    .btn-custom-upload:hover {
        background: linear-gradient(135deg, #37a99a, #4b7ce3);
        box-shadow: 0 8px 20px rgba(68, 209, 194, 0.4);
        transform: translateY(-3px);
    }
    
    .btn-custom-edit:hover {
        background: linear-gradient(135deg, #e0a800, #ffca2c);
        box-shadow: 0 8px 20px rgba(255, 193, 7, 0.4);
        transform: translateY(-3px);
    }
    
    .btn-custom-save:hover {
        background: linear-gradient(135deg, #218838, #2ecc71);
        box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
        transform: translateY(-3px);
    }
    
    .btn-custom-download:hover {
        background-color: #37a99a;
        box-shadow: 0 5px 15px rgba(68, 209, 194, 0.4);
        transform: translateY(-2px);
    }
    
    .btn-custom-verify:hover {
        background-color: #4b7ce3;
        box-shadow: 0 5px 15px rgba(94, 147, 240, 0.4);
        transform: translateY(-2px);
    }
    
    .btn-custom-delete:hover {
        background: linear-gradient(135deg, #c82333, #e4606d);
        box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        transform: translateY(-2px);
    }
    
    .btn {
        font-weight: 500;
        transition: all 0.3s ease;
    }
    
    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    }
    
    .table-dark {
        background-color: #1a2e3b;
        color: #d1e7e0;
    }
    
    .table-dark thead th {
        font-weight: 600;
        letter-spacing: 0.5px;
        border-bottom: none;
    }
    
    .table-dark.table-hover tbody tr:hover {
        background-color: rgba(255, 255, 255, 0.05);
    }
    
    .form-control, .form-select {
        transition: all 0.3s ease;
    }
    
    .form-control:focus, .form-select:focus {
        border-color: #44d1c2;
        box-shadow: 0 0 0 0.25rem rgba(68, 209, 194, 0.25);
    }
    
    .dropdown-menu {
        backdrop-filter: blur(10px);
        min-width: 250px !important;
        z-index: 1000;
    }
    
    .dropdown-menu .input-group {
        width: 100% !important;
    }
    
    .border-teal {
        border: 1px solid #44d1c2 !important;
    }
    
    .backdrop-blur-md {
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
    }
    
    /* Validation styles */
    .needs-validation .form-control:invalid, .needs-validation .form-select:invalid {
        border-bottom: 2px solid #dc3545;
    }
    
    .needs-validation .form-control:valid, .needs-validation .form-select:valid {
        border-bottom: 2px solid #28a745;
    }

    /* Uniform button styles for the Actions column */
    .uniform-btn {
        width: 100px;
        height: 36px;
        padding: 8px 12px;
        font-size: 14px;
        line-height: 1.5;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* **** NEW/MODIFIED CSS FOR EDIT USER MODAL **** */
    /* Styles for the custom Edit User Modal to match screenshot and ensure interactivity */
    .modal-user-edit-custom.modal-content {
        background-color: #f8f9fa; /* Light grey background (Bootstrap $gray-100) */
        color: #212529;            /* Dark text (Bootstrap $gray-900) */
        border: 1px solid #dee2e6; /* Light border (Bootstrap $gray-300) */
        border-radius: 0.5rem;       /* Standard Bootstrap modal border-radius */
        pointer-events: auto !important; /* Crucial for interactivity if something is disabling it */
    }

    .modal-user-edit-custom .modal-header {
        border-bottom: 1px solid #dee2e6; /* Light grey border for header */
        color: #212529; /* Ensure header text is dark */
    }
    
    .modal-user-edit-custom .modal-header .btn-close {
        /* Bootstrap 5 btn-close is designed to adapt, but if issues:
           filter: invert(0) grayscale(100%) brightness(0%); 
        */
    }

    .modal-user-edit-custom .modal-body {
        color: #212529; /* Ensure body text is dark */
    }

    .modal-user-edit-custom .form-label {
        color: #212529 !important; /* Dark text for labels */
    }

    .modal-user-edit-custom .form-control {
        background-color: #fff !important;        /* Standard white background for inputs */
        color: #212529 !important;                /* Dark text for input content */
        border: 1px solid #ced4da !important;     /* Standard input border (Bootstrap $gray-400) */
    }

    .modal-user-edit-custom .form-control:focus {
        border-color: #86b7fe !important; /* Bootstrap default blue focus color */
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25) !important; /* Bootstrap default focus shadow */
    }

    .modal-user-edit-custom .modal-footer {
        border-top: 1px solid #dee2e6; /* Light grey border for footer */
    }

    /* Ensure buttons in the footer use standard Bootstrap styling */
    .modal-user-edit-custom .modal-footer .btn-secondary {
        /* Default Bootstrap styles should apply, making it grey. Can be explicit if needed:
           background-color: #6c757d; color: #fff; border-color: #6c757d;
        */
    }
    .modal-user-edit-custom .modal-footer .btn-primary {
        /* Default Bootstrap styles should apply, making it blue. Can be explicit if needed:
           background-color: #0d6efd; color: #fff; border-color: #0d6efd;
        */
    }
    /* **** END OF NEW/MODIFIED CSS FOR EDIT USER MODAL **** */

    /* Modal fixes */
    .modal {
        z-index: 1050 !important;
    }

    .modal-backdrop {
        z-index: 1040 !important;
    }

    .modal-content {
        pointer-events: auto !important;
    }

    .modal input.form-control:focus {
        box-shadow: 0 0 0 0.25rem rgba(68, 209, 194, 0.25);
        border-color: var(--primary-teal);
    }

    .btn-close:focus {
        box-shadow: 0 0 0 0.25rem rgba(68, 209, 194, 0.25);
    }
</style>

<!-- Additional Scripts for Admin Panel -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Initialize tooltips
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        });
        
        // Add animation to tables
        const tables = document.querySelectorAll('table');
        tables.forEach(table => {
            if (typeof gsap !== 'undefined') {
                gsap.from(table.querySelectorAll('tbody tr'), {
                    opacity: 0,
                    y: 20,
                    duration: 0.5,
                    stagger: 0.05,
                    ease: "power2.out",
                    delay: 0.3
                });
            }
        });
        
        // Add animation to cards
        const cards = document.querySelectorAll('.card');
        cards.forEach((card, index) => {
            if (typeof gsap !== 'undefined') {
                gsap.from(card, {
                    opacity: 0,
                    y: 30,
                    duration: 0.8,
                    delay: 0.1 * index,
                    ease: "power3.out"
                });
            }
        });
        
        // Form validation
        (function() {
            'use strict';
            var forms = document.querySelectorAll('.needs-validation');
            Array.prototype.slice.call(forms).forEach(function(form) {
                form.addEventListener('submit', function(event) {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        })();
    });

    document.addEventListener('DOMContentLoaded', function() {
        // Ensure modals are properly initialized
        var modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            new bootstrap.Modal(modal);
            
            // Move modal to body to prevent stacking context issues
            document.body.appendChild(modal);
            
            // Remove any click event stopPropagation
            modal.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        });
    });
</script>
{% endblock %}